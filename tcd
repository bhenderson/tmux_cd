#!/bin/bash

exact_match() {
  tmux list-session -F "#{session_name}" | grep --quiet -x $name && tmux attach-session -t $name
}

# one match, use it
# two matches, error out
close_match() {
  matches=($(tmux list-session -F "#{session_name}" | grep $name))

  case ${#matches[*]} in
    0) # no match
      return
      ;;
    1) # closest match
      tmux attach-session -t $matches
      ;;
    *)
      # disambiguate
      tmux list-session | grep $name
      exit
      ;;
  esac
}

new() {
  tmux new-session -s $name "$@"
}

name=$1
shift

if [ -z "$name" ]; then
  tmux list-session
  exit
fi

# $name is a valid directory, go to it and start tmux
if [ -d "$name" ]; then
  cd $name
  name=`basename $PWD`
fi

exact_match || close_match || new "$@"
